name: frrk8s
prefix: ""

topology:
  nodes:
    ### fabric ###
    frrspine:
      kind: linux
      image: frrouting/frr:latest
      binds:
        - configs/frrspine.conf:/etc/frr/frr.conf
        - configs/frrdaemons:/etc/frr/daemons
        - configs/vtysh.conf:/etc/frr/vtysh.conf
      exec:
        - sysctl -w net.ipv4.ip_forward=1
    frrleaf1:
      kind: linux
      image: frrouting/frr:latest
      binds:
        - configs/frrleaf1.conf:/etc/frr/frr.conf
        - configs/frrdaemons:/etc/frr/daemons
        - configs/vtysh.conf:/etc/frr/vtysh.conf
      exec:
        - sysctl -w net.ipv4.ip_forward=1
    frrleaf2:
      kind: linux
      image: frrouting/frr:latest
      binds:
        - configs/frrleaf2.conf:/etc/frr/frr.conf
        - configs/frrdaemons:/etc/frr/daemons
        - configs/vtysh.conf:/etc/frr/vtysh.conf
      exec:
        - sysctl -w net.ipv4.ip_forward=1
    br-clab:
      kind: bridge

    ### minikube cluster ###
    mkcluster:
      kind: ext-container
      exec:
        - ip address add 192.168.200.11/24 dev eth1
        - ip add default via 192.168.200.1
    mkcluster-m02:
      kind: ext-container
      exec:
        - ip address add 192.168.200.22/24 dev eth1
        - ip add default via 192.168.200.1

    ### client ###
    client:
      kind: linux
      image: ghcr.io/hellt/network-multitool
      exec:
        - ip delete default via 172.20.20.1
        - ip addr add 192.168.100.11/24 dev eth1
        - ip route add default via 192.168.100.1

  links:
    - endpoints: ["frrspine:eth1", "frrleaf1:eth1"]
    - endpoints: ["frrspine:eth2", "frrleaf2:eth1"]
    - endpoints: ["frrleaf2:eth2", "br-clab:eth1"]
    - endpoints: ["mkcluster:eth1", "br-clab:eth2"]
    - endpoints: ["mkcluster-m02:eth1", "br-clab:eth3"]
    - endpoints: ["client:eth1", "frrleaf1:eth2"]
